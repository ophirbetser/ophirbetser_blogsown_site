---
title: היכרות עם lubridate
author: ophir betser
date: '2021-09-29'
slug: lubridate
categories: []
tags: []
subtitle: 'מדריך קצר לעבודה נכונה יותר עם תאריכים ב R'
summary: 'מדריך קצר לעבודה נכונה יותר עם תאריכים ב R'
authors: [ophir betser]
lastmod: '2021-09-29T23:08:50+03:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

<html dir="rtl">

### תאריך כסוג של משתנה

סוגי המשתנים שהכי שכיח להשתמש בהם ב
R 
הם מספרים, מחרונות, ומשתנים בוליאנים
(משתנים שמקבלים ערך של או אמת או שקר)
.

על כל סוג משתנה ניתן לבצע פעולות,
נניח אפשר לחבר 2 מספרים

<div style="text-align:left;" dir="ltr">
```{r}
88 + 54
```
</div>

או להפוך את כל האותיות במחרוזת לאותיות ראשיות

<div style="text-align:left;" dir="ltr">
```{r}
my_name <- 'inigo montoya'
print(toupper(my_name))
```
</div>

בניתוח נתונים אנחנו הרבה פעמים מוצאים את עצמנו עובדים עם דאטה שיש בו משמעות לזמן,
והוא מכיל משתנה מסוג תאריך.

עבודה עם תאריכים ב
R
יכולה להיות מאוד מתסכלת וקשה,
כי הפקודות הבסיסיות של השפה אינן כתובות באופן ידידותי למשתמש.

אבל אל דאגה! 
  
יש ספריה שתעשה לכם את החיים הרבה יותר קלים ופשוטים.

### lubridate

lubridate
היא ספריה שהמטרה שלה היא להפוך את העבודה עם משתני תאריכים לקלה.

בשימושים העיקרים שלי בה הם:  
  
1. שינוי וקטורים לפורמט תאריך (היא יודעת לעבוד אינספור פורמטים שונים)
2. חילוץ נתון מסוים, כמו היום בשבוע מתוך וקטור תאריכים
3. חישובים של הפרשי זמנים

### שימוש ב Chear Sheets

לחלר גדול מהספריות בכי פופולאריות ב
R
ניתן למצוא פוסטרים שימושים
שמסבירים איך להשתמש בפונקציות של הספריה באופן נגיש ואינטואיטיבי.

הכינוי של הפוסטרים האלו הוא
"Cheat Sheets" 
ואפשר למצוא אותם ישר מתוך
Rstudio
על ידי לחיצה על 

<div style="text-align:center;" dir="ltr">
Help -> Cheat sheets -> Browse Cheets Sheets...
</div>

![](index.en_insertimage_1.png)

לאחר הלחיצה תועברו לקישור [https://www.rstudio.com/resources/cheatsheets/](https://www.rstudio.com/resources/cheatsheets/)
שבין השאר, ניתן למצוא בו קובץ הסברים על lubrudate

![](index.en_insertimage_2.png)

אני ממליץ להציץ בקובץ, ובקבצים מקבילים של ספריות אחרות. ניתן ללמוד מהם הרבה.

### שימוש בספריה
אני הדגים איך לבצע את 3 המשימות הבסיסיות שיש לנו בעבודה עם תאריכים

אטען את הספריה עם pacman,
המשמשת כמנהל הספריות ב
R.

אם אתם לא מכירים אותה, תקראו את
[הפוסט שבו אני מסביר עליה
](/post/איך-לטעון-ספריות-בקלות-ב-r/)

<div style="text-align:left;" dir="ltr">
```{r}
pacman::p_load(lubridate)
```
</div>


#### 1 התאמת פורמט תאריך
לפני שאנחנו מנתחים תאריכים, ראשית יש לוודא שהפורמט של המשתנה הוא אכן פורמט של תאריך,
ולא חלילה מחרוזת.

ראשית, אצור וקטורי מחרוזות שמכילים ״תאריכים״ במספר פורמטים שונים

<div style="text-align:left;" dir="ltr">
```{r}
date_format_1 <- c("2020-04-29", "2020-09-06", "2020-09-30")
date_format_2 <- c("2020/04/29", "2020/09/06", "2020/09/30")
date_format_3 <- c("29.4.2020", "6.9.2020", "30.9.2020")
```
</div>

ואראה שהסוג משתנה שהם עכשיו הוא מחרוזת ולא תאריך

<div style="text-align:left;" dir="ltr">
```{r}
print(class(date_format_1))
print(class(date_format_2))
print(class(date_format_3))
```
</div>

הוקטור הראשון הוא במבנה ש
R
רוצה שתאריך יהיה בו.
שנה, חודש ואז יום.

כדי לשנות אותו למשתנה מסוג תאריך נשתמש בפונקציה

<div style="text-align:left;" dir="ltr">
```{r}
date_format_1 <- as_date(date_format_1)
```
</div>

ונוודא שאכן המשתנה שונה:
<div style="text-align:left;" dir="ltr">
```{r}
print(class(date_format_1))
```
</div>

מגניב.

שתי הוקטורים הנוספים הם תאריכים בפורמט קצת אחר.

הדרך לשנות להמיר אותם לתאריכים ב
lubridate 
נראת ככה:

<div style="text-align:left;" dir="ltr">
```{r}
date_format_2 <- ymd(date_format_2)
date_format_3 <- dmy(date_format_3)

print(date_format_2)
print(date_format_3)
```
</div>

ניתן לראות שאכן המשימה בוצאה, פשוט על ידי התאמת הפונקציה למשתנה התאריך במחרוזת שקיבלנו,
כאשר 
y 
צריך להיות במקום שהחלק של השנה נצבמא בתאריך שלנו
m
צריך להיות במקום שהחלק של החודש נמצא בתאריך שלנו,
ו
d
במקום שבו מופיע היום.

#### 2 חילוץ מידע מתאריכים

מעולה. הוקטורים שלנו עכשיו משתני תאריך, ואנחנו יכולים להפעיל המון פונקציות עליהם!

נניח שאני רוצה לדעת מאיזה יום בשבוע, או מאיזה תאריך בשנה התאריך שלי לקוח.

הדרך של 
lubridate
לעשות את זה נראת ככה:

<div style="text-align:left;" dir="ltr">
```{r}
wday(date_format_1)
week(date_format_1)
```
</div>

ובאופן דומה ניתן להוציא כל שביב מידע מהתאריכים שלכם
דוגמאות רבות לאיך לעשות זאת ניתן למצוא ב
Cheat Sheet
 של הספריה.


#### 3 מרחק בין תאריכים

מעניין לדעת, מה היה התאריך לפני 50 יום, לכל אחד מהתאריכים בוקטור שלי

<div style="text-align:left;" dir="ltr">
```{r}
date_format_1 - days(50)
```
</div>

קליל ופשוט, הרבה יותר טוב מהדרך של
base-r

### סרטון הסבר על הספריה
בסרטון הזה שהועבר כחלק 
״כלכלה בעולם הביג דאטה״ - קורס בפקולטה לכלכלה של אוניברסיטת תל אביב
אני מסביר מעט יותר בפירוט על הספריה ועל עבודה עם תאריכים.

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/LehJz9s2Y_A" frameborder="0" allowfullscreen></iframe>
</div>

  
  
      
תהנו
:)
